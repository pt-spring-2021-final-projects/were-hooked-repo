//fetch json data from api
// console.log(fetch('http://localhost:8080/api/waters')
//     .then(response => response.json()))
// import { boundaryCanvas } from 'BoundaryCanvas'

const ohio = {"type":"Polygon","coordinates":[[[-84.82028448819293,39.21868269539534],[-84.82006468819296,39.13029039540185],[-84.75948588820138,39.14394229540083],[-84.72644318820599,39.142136595400956],[-84.71238998820793,39.13070989540181],[-84.61987258822082,39.073409095406056],[-84.55472428822989,39.09758929540429],[-84.54383728823142,39.099784895404106],[-84.52251478823436,39.092206195404664],[-84.49615428823806,39.101279995404006],[-84.48519438823956,39.11368279540308],[-84.44430478824526,39.11315089540312],[-84.44078688824577,39.1091823954034],[-84.42417438824805,39.05205649540763],[-84.31993618826256,39.021576595409904],[-84.29941028826543,38.98922969541233],[-84.29749038826569,38.98169999541287],[-84.27962678826819,38.94373299541569],[-84.26355188827041,38.9287701954168],[-84.26135888827072,38.92619619541699],[-84.25289598827192,38.91686909541771],[-84.23152728827488,38.872490495421],[-84.21878468827664,38.81065759542564],[-84.21069628827776,38.8048102954261],[-84.15179928828596,38.793923695426905],[-84.14458948828697,38.79212919542703],[-84.13404948828845,38.78928259542726],[-84.05283628829973,38.77103229542863],[-84.02045258830425,38.77569779542826],[-83.99908068830723,38.781318395427846],[-83.97547728831051,38.78722279542739],[-83.96133668831249,38.787306495427394],[-83.85367058832746,38.75267739543],[-83.84003638832937,38.721376495432345],[-83.82634638833127,38.711917095433066],[-83.78395998833716,38.695834195434266],[-83.75062748834182,38.649571895437774],[-83.71796798834636,38.64507959543811],[-83.7054538883481,38.63969139543851],[-83.62018128835999,38.68130369543538],[-83.59449648836356,38.687568095434884],[-83.38489788839271,38.66300969543677],[-83.375731588394,38.661172195436905],[-83.26784628840903,38.618092495440166],[-83.01169438844468,38.72992569543172],[-82.97474628844982,38.72691199543193],[-82.96468268845122,38.73153209543159],[-82.94789958845357,38.74081649543088],[-82.91767428845777,38.75167439543007],[-82.87421198846381,38.745284195430564],[-82.83649798846909,38.58382299544273],[-82.81601698847192,38.57076699544373],[-82.8118089884725,38.5684949954439],[-82.74515528848177,38.5593163954446],[-82.71649398848577,38.552495995445106],[-82.66009098849362,38.500111995449096],[-82.62962698849788,38.481568995450495],[-82.59766998850232,38.42879609545452],[-82.56017818850752,38.404228895456406],[-82.49455028851668,38.41541909545554],[-82.46309968852105,38.4238480954549],[-82.43357388852516,38.43051319545441],[-82.38629188853173,38.435051595454034],[-82.3742277885334,38.43622759545396],[-82.30319368854329,38.50429039544878],[-82.30334038854328,38.52118129544749],[-82.2873364885455,38.58282379544281],[-82.27336998854744,38.59418299544197],[-82.26491518854864,38.59744209544171],[-82.18708398855946,38.66854689543632],[-82.21614508855544,38.76841699542882],[-82.2170014885553,38.79601519542673],[-82.1493739885647,38.835548995423785],[-82.14705608856504,38.83766489542362],[-82.14355598856552,38.844179995423154],[-82.14093958856589,38.873688495420915],[-82.11360898856968,38.930163895416726],[-82.10797468857047,38.946878795415465],[-82.10449698857096,38.95128539541514],[-82.09878708857175,38.95845399541461],[-82.08599598857353,38.9774119954132],[-82.04443898857932,39.00804799541091],[-82.0014546885853,39.02725409540947],[-81.98412768858772,39.00596709541105],[-81.97498458858898,38.99245629541206],[-81.94872038859265,38.99567499541182],[-81.94810018859273,38.995321395411864],[-81.92041978859659,38.970434295413696],[-81.91631928859714,38.96428229541416],[-81.75605248861946,39.18031409539815],[-81.72586038862366,39.21569729539555],[-81.60027408864114,39.274924695391206],[-81.57061198864528,39.2678788953917],[-81.56535468864602,39.28826029539019],[-81.565360288646,39.29062009539004],[-81.4692920886594,39.402577295381846],[-81.46761518865962,39.403539695381774],[-81.43484818866418,39.40812249538143],[-81.41632898866675,39.39763829538222],[-81.0712369887148,39.515361995373645],[-81.055252988717,39.52704799537281],[-81.0388265887193,39.53978039537187],[-80.86701708874324,39.75555449535631],[-80.847059988746,39.78445699535423],[-80.8212789887496,39.84998199534953],[-80.79142548875373,39.874974995347735],[-80.76051788875805,39.90822799534538],[-80.76152688875791,39.932586795343624],[-80.75636738875863,39.96039699534166],[-80.75253458875916,39.96252029534151],[-80.74007198876089,39.9752655953406],[-80.739215788761,39.97766709534043],[-80.73947108876096,39.991554995339456],[-80.73929298876101,39.99396089533928],[-80.73334928876183,40.03338249533649],[-80.73159718876208,40.0504850953353],[-80.73732588876128,40.06511119533424],[-80.73268188876192,40.08478029533286],[-80.70963098876511,40.137418595329144],[-80.70247698876612,40.15710409532774],[-80.70001998876647,40.16097559532748],[-80.68709618876827,40.179052295326215],[-80.67936608876933,40.1860727953257],[-80.61988538877762,40.26580889532013],[-80.6120994887787,40.29777449531789],[-80.60697218877942,40.304749895317386],[-80.60321058877996,40.31081819531699],[-80.60124298878021,40.317694995316494],[-80.60465028877975,40.328469695315746],[-80.60754668877935,40.33404279531535],[-80.61175958877875,40.34067879531489],[-80.63001018877621,40.3864023953117],[-80.61291718877858,40.43708699530817],[-80.60014968878036,40.482191695305055],[-80.6005468887803,40.48325309530496],[-80.62586668877678,40.53081239530169],[-80.66795698877092,40.58249599529812],[-80.63256298877586,40.617198995295745],[-80.59878338878056,40.6251356952952],[-80.51899788879166,40.643042595293956],[-80.51902818879167,40.89964649527646],[-80.51907268879165,41.13335079526071],[-80.51921858879165,41.33350459524737],[-80.51924028879164,41.350919995246215],[-80.51930468879164,41.49910819523644],[-80.51937638879161,41.892135595210924],[-80.51935418879161,41.97727769520549],[-81.00533948872398,42.24595369518844],[-81.47848468865811,42.100599995197626],[-81.86911008860373,41.926275895208725],[-82.26895058854807,41.74148129522064],[-82.7299059884839,41.70069009522329],[-83.0625599884376,41.860441195212964],[-83.45533838838293,41.7328518952212],[-83.46734478838125,41.73253009522122],[-83.49238848837776,41.732024195221264],[-83.6495129883559,41.72744259522156],[-83.68540658835089,41.726501095221614],[-83.74609798834246,41.72412099522175],[-83.81121098833339,41.72220499522188],[-83.85113388832782,41.72133899522195],[-83.88041048832375,41.72008209522202],[-84.3995360882515,41.705841195222966],[-84.47594588824084,41.703870395223085],[-84.57281168822736,41.7018934952232],[-84.68948948821112,41.69956379522337],[-84.80573028819494,41.61899159522859],[-84.80452728819513,41.51291599523553],[-84.80405508819517,41.42604299524125],[-84.80352578819524,41.252559495252726],[-84.8031724881953,40.98934339527039],[-84.80228838819541,40.728147995288104],[-84.8039083881952,40.35277439531404],[-84.81253238819399,39.917077995344755],[-84.81508198819365,39.573741995369424],[-84.81508438819365,39.57294799536944],[-84.81511238819364,39.56774039536984],[-84.81512288819364,39.56534769537001],[-84.81512178819364,39.564847095370055],[-84.81603688819351,39.47936159537624],[-84.81774558819326,39.39176699538265],[-84.81938948819305,39.30518559538898],[-84.819621988193,39.270125995391545],[-84.81968068819302,39.26850019539167],[-84.819704088193,39.26769239539173],[-84.82008598819294,39.25127329539294],[-84.82010268819295,39.248927395393096],[-84.82028448819293,39.21868269539534]]]}


async function fetchWaters() {
    try {
        const response = await fetch(`/api/waters/`, {
            method: 'GET',
            credentials: 'same-origin'
        })
        const waters = await response.json()
        return waters
    } catch (error) {
        console.error(error);
    }
}

async function mapWaters(map) {
    const fishListToHTMLList = fishList => fishList.map(fish => `<li>${fish.name}</li>`).join``
    const waters = await fetchWaters()
    for (let water of waters) {
        const marker = L.marker([water.latitude, water.longitude]).addTo(map)
         marker.bindPopup(`<a href="/waters/${water.name}"> ${water.name}</a>
         <br>
         <ul>Fish:
            ${fishListToHTMLList(water.fish)}
        </ul>`)
    }
}

function initmap() {
    console.log("draw map")
    const centerOfOhio = [40.367474, -82.996216]
    // var corner1 = L.latLng(42, -80),
    //     corner2 = L.latLng(38, -85),
    //     bounds = L.latLngBounds(corner1, corner2);

    const map = new L.Map('map').setView(centerOfOhio, 7);

   //works great 
    // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    //     maxZoom: 18,
    //     id: 'mapbox/outdoors-v11',
    //     tileSize: 512,
    //     zoomOffset: -1,
    //     accessToken: 'pk.eyJ1IjoiemNhc3NpbmkiLCJhIjoiY2tzM2t0ZWd3MG9oZTJvbXR4bWc0eXpseCJ9.nY0uXdRiSG1TYWWP0Qj24Q'
    // }).addTo(map);

    L.TileLayer.boundaryCanvas('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        boundary: ohio,
        maxZoom: 18,
        minZoom: 7,
        id: 'mapbox/outdoors-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiemNhc3NpbmkiLCJhIjoiY2tzM2t0ZWd3MG9oZTJvbXR4bWc0eXpseCJ9.nY0uXdRiSG1TYWWP0Qj24Q'
    }).addTo(map);

    // var osm =  L.TileLayer.boundaryCanvas('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    //     boundary: ohio.geometry,
    //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    //     maxZoom: 18,
    //     id: 'mapbox/outdoors-v11',
    //     tileSize: 512,
    //     zoomOffset: -1,
    //     accessToken: 'pk.eyJ1IjoiemNhc3NpbmkiLCJhIjoiY2tzM2t0ZWd3MG9oZTJvbXR4bWc0eXpseCJ9.nY0uXdRiSG1TYWWP0Qj24Q'
    // }).addTo(map)

    // map.setMaxBounds(bounds)

    mapWaters(map)
}

initmap()